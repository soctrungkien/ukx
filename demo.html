<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>UKX Encrypt/Decrypt</title>
    <meta name="description" content="https://pastefy.app/GmYokajf/raw">
    <style>
        body {
            font-family: monospace;
            background: #0d1117;
            color: #e6edf3;
            padding: 20px;
        }
        h2 { color: #58a6ff; }
        .input-field {
            box-sizing: border-box;
            width: 100%;
            padding: 12px;
            margin: 8px 0 20px;
            background: #161b22;
            color: #e6edf3;
            border: 1px solid #30363d;
            border-radius: 8px;
            font-family: monospace;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.25);
        }
        button {
            padding: 10px 15px;
            margin-right: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-family: monospace;
            transition: all 0.3s ease;
        }
        pre {
            background: #161b22;
            padding: 15px;
            border-radius: 6px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* Kiểu dáng chung cho tất cả các nút gradient */
        .gradient-button {
            color: white;
            border: none;
            padding: 10px 20px;
            font-weight: 500;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .purple-blue-gradient {
            background-image: linear-gradient(to bottom right, #8b5cf6, #3b82f6);
        }
        .cyan-blue-gradient {
            background-image: linear-gradient(to right, #06b6d4, #3b82f6);
        }
        .copy-button-gradient {
            background-image: linear-gradient(to right, #555, #333);
        }
        .purple-blue-gradient:hover, .purple-blue-gradient:focus {
            background-image: linear-gradient(to bottom left, #8b5cf6, #3b82f6);
            outline: none;
        }
        .cyan-blue-gradient:hover, .cyan-blue-gradient:focus {
            background-image: linear-gradient(to bottom left, #06b6d4, #3b82f6);
            outline: none;
        }
        .copy-button-gradient:hover, .copy-button-gradient:focus {
            background-image: linear-gradient(to left, #555, #333);
            outline: none;
        }
        .purple-blue-gradient:focus { box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5); }
        .cyan-blue-gradient:focus { box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.5); }
        .copy-button-gradient:focus { box-shadow: 0 0 0 4px rgba(85, 85, 85, 0.5); }

        /* Kiểu cho chế độ live mode */
        .active-mode {
            box-shadow: 0 0 0 2px #e6edf3, 0 0 0 4px #58a6ff;
        }
    </style>
</head>
<body>
    <h2>UKX Encrypt/Decrypt</h2>

    <label>Mật khẩu</label>
    <input class="input-field" type="password" id="password" placeholder="Để trống nếu không muốn dùng mật khẩu...">

    <label>Dữ liệu gốc / mã hóa</label>
    <textarea class="input-field" id="inputText" rows="4" placeholder="Nhập dữ liệu..."></textarea>

    <div>
        <button class="gradient-button purple-blue-gradient encrypt" id="btnEncrypt">Mã hóa</button>
        <button class="gradient-button cyan-blue-gradient decrypt active-mode" id="btnDecrypt">Giải mã</button>
    </div>

    <h3>Kết quả:</h3>
    <button id="btnCopy" class="gradient-button copy-button-gradient" style="margin-bottom: 8px;">Sao chép</button>
    <pre id="output"></pre>

    <script type="module">
        const url = "https://soctrungkien.github.io/ukx/ukx.js?r=" + Date.now();
        const { encrypt, decrypt } = await import(url);

        const input = document.getElementById("inputText");
        const pass = document.getElementById("password");
        const output = document.getElementById("output");
        const btnEncrypt = document.getElementById("btnEncrypt");
        const btnDecrypt = document.getElementById("btnDecrypt");
        const btnCopy = document.getElementById("btnCopy");

        let currentMode = 'decrypt'; // Chế độ mặc định

        const processData = async () => {
            const text = input.value.trim();
            const pw = pass.value.trim();
            output.textContent = ''; // Xóa output cũ

            // Điều kiện đã được chỉnh sửa để cho phép mật khẩu trống
            if (!text) {
                return;
            }

            try {
                let result;
                if (currentMode === 'encrypt') {
                    result = await encrypt(text, pw);
                } else { // 'decrypt'
                    result = await decrypt(text, pw);
                }
                output.textContent = result;
            } catch (e) {
                output.textContent = e.message;
            }
        };

        // Gán sự kiện cho các ô nhập liệu
        input.addEventListener('input', processData);
        pass.addEventListener('input', processData);

        // Gán sự kiện cho các nút
        btnEncrypt.onclick = () => {
            currentMode = 'encrypt';
            btnEncrypt.classList.add('active-mode');
            btnDecrypt.classList.remove('active-mode');
            processData();
        };

        btnDecrypt.onclick = () => {
            currentMode = 'decrypt';
            btnDecrypt.classList.add('active-mode');
            btnEncrypt.classList.remove('active-mode');
            processData();
        };

        btnCopy.onclick = async () => {
            try {
                const textToCopy = output.textContent;
                if (textToCopy) {
                    await navigator.clipboard.writeText(textToCopy);
                    const originalText = btnCopy.textContent;
                    btnCopy.textContent = "Đã sao chép!";
                    setTimeout(() => {
                        btnCopy.textContent = originalText;
                    }, 2000);
                }
            } catch (err) {
                console.error('Không thể sao chép:', err);
                const originalText = btnCopy.textContent;
                btnCopy.textContent = "Lỗi sao chép!";
                setTimeout(() => {
                    btnCopy.textContent = originalText;
                }, 2000);
            }
        };
    </script>
</body>
</html>
